/**
 *Submitted for verification at Etherscan.io on 2023-05-28
*/

// SPDX-License-Identifier: MIT

/*
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB######BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB###BBGGGPPPP5PPPGGBBB####BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB#BBPYJ7!~~~^^^^^^^~~~~!!7?J5PGB##BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBB#BPY7~~~~~~~~~~!!!!!!!!!!!!!~~~~!?YPB#BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBGY7~~~~!!?JJJJJJJ??!!!!!!!!!7???????77YGBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBB#BGBBY7!~!!!!!?BBBBBBBBBBJ!!!!!!7YBBBBBBBBG7!7JG#BBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBB#BBB#G7::??!!!!!!!777Y555YYYJJ?7!!!!!!7?JJYY55PPY7777?P#BBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBB#5~^7J^.^!???777777!!~~~~~~~~~~~!!!!!!!!~~~~~~!!!!!777775BBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBG~:^!!~7?7~^~!!777!!~~^^^^^^^^~~~!77!!7!~~~~~~~~~~~!!7777YBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBB#J^~!7~^7~::^:.:!777777?JY5PPPP5YJ???77777!7?J5PGGGPP5YJ?77P#BBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBJ~~~!~~77PGGPJ?PGGBB#&@@@@&&&&&@@&&#G55PGB#&@&&&&&&@@@&&#B#&#BBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBB#Y~~~~~~?5555JYG&@@@@@@&##BBBBBBB##&@@@@@@@&#BBBBBBBB#&@@@@&B#BBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBB#P~:::^!77??!^::~JY#@@@#BBBBBBBBBBBB#&@@&@@&BBBBBBBBBBBB&@@@5JBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBB#P^::::^~7!::^:^[email protected]@@#BBBBBBBBBBBBB&@#[email protected]@#BBBBBBBBBBB#&@@P7?GBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBB!::::^^~77~^^^[email protected]@&#BBBBBBBBBB#&@&[email protected]&#BBBBBBBBB#&@&57??P#BBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBB#5~^^^^^~!?7777??7777[email protected]@&##BBBB##&@@BJ77?P&@&&#####&@@&GJ7???P#BBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBG?^^^^^~~7YYYJ?77777777777YG#@@@@@@@&#GJ777777?5B#&&&&&#B5J7?????P#BBBB###BBBBBBBBBBBBBBB
BBBBBBBBBBBB57~^::^~JB5Y?777777777777777?YY55YJ?7!!7777777777????77!77???77?GBBBBBPJJPBBBBBBBBBBBBBB
BBBBBBBBBBBB##BGP5JJYB5Y?77777????77!!!!!!!!!!!!!!!!!!!!!!!!!!!!!777???7777JBBBBBG!:.!BBBBBBBBBBBBBB
BBBBBBBBBBBBBBBB#####BPJJ?7777777777!!!!~~!!!!!7!7777!7777!77777777777!!!7?PBBBB#P!^:~GBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBYJJ?777!!!777777!!~77777?7777?7?YPGPY?7!7777?77777?YBBBBB#5!~^:?B####BBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBGYJJ?7777777??77!!~!~!!!7!!!!7!!!7JPB#PJ!7??77777?YBBBB##B?~~^:.^!?YPGBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBGYJJ?777777?????77!!!!!7!!!77!!!!!!7P&&GY?77777?YBBBBBPJJ!!~7~^:.  .:!PBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBG5JJ??7777777??J???777!!!!!!!!!77???5#&#P?77?JPBBBB#J.^!!!!77~^^:::::7BBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBPYJJ??77777777??JJJJJJJ????JJJJJJ?7Y##G5JJPBGPPPGG?~!~~!!77~^::^^^:~BBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBPYJJ???777777777?????????????????7JP55Y5PGPP5555P?~!~~~77~^^:^^^^7BBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBGPYJJ???????????????????????????J5GP555PGPPP55PP5YY??7^~~~~~~^^Y#BBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBGP5YJJ????????????????JJJYY5GBBBBGPPGGPPPPPPG###BG?^^:::::^?BBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBGGPP555555PPPPPGGGBBBB#BBBBBBGGGGPPPPPPBBBBBBGY?7!7?JPBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB##BBBBB#####BBBBBBBBBBBBBBBBBBBGGGPGBBBBBBBB##BBB###BBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
*/

pragma solidity ^0.8.0;

/// @title KerbitStore: A simple store smart contract
contract KerbitStore {
    address payable public owner;
    mapping(uint256 => uint256) public itemPrices;

    /// @dev Event emitted when a payment is received
    event PaymentReceived(
        address indexed buyer,
        uint256 totalAmountPaid,
        uint256[] itemIds,
        uint256[] quantities
    );

    /// @dev Event emitted when a withdrawal is made
    event Withdrawn(address indexed to, uint256 amount);

    /// @dev Event emitted when an item's price is updated
    event ItemPriceUpdated(uint256 indexed itemId, uint256 price);

    /// @dev Sets the contract deployer as the owner
    constructor() {
        owner = payable(msg.sender);
    }

    /// @dev Modifier to restrict access to onlyOwner functions
    modifier onlyOwner() {
        require(msg.sender == owner, "Only the owner can perform this action");
        _;
    }

    /// @notice Set the price for an item in wei
    /// @param itemId The unique identifier for the item
    /// @param price The price of the item in wei
    function setItemPrice(uint256 itemId, uint256 price) external onlyOwner {
        itemPrices[itemId] = price;
        emit ItemPriceUpdated(itemId, price);
    }

    /// @notice Make a payment for purchasing items
    /// @param itemIds An array of itemIds that the user wants to purchase
    /// @param quantities An array of quantities corresponding to each itemId
    function makePayment(uint256[] memory itemIds, uint256[] memory quantities) external payable {
        require(itemIds.length == quantities.length, "Item IDs and quantities must have the same length");
        uint256 requiredAmount = calculateRequiredAmount(itemIds, quantities);

        require(msg.value >= requiredAmount, "Incorrect payment amount");

        emit PaymentReceived(msg.sender, msg.value, itemIds, quantities);
    }

    /// @notice Calculate the total required amount for purchasing items
    /// @param itemIds An array of itemIds that the user wants to purchase
    /// @param quantities An array of quantities corresponding to each itemId
    /// @return totalAmount The total amount required based on the provided itemIds and quantities
    function calculateRequiredAmount(uint256[] memory itemIds, uint256[] memory quantities) internal view returns (uint256 totalAmount) {
        for (uint256 i = 0; i < itemIds.length; i++) {
            totalAmount += itemPrices[itemIds[i]] * quantities[i];
        }
    }

    /// @notice Withdraw the accumulated balance from the contract
    function withdraw() external onlyOwner {
        uint256 amount = address(this).balance;
        (bool success, ) = owner.call{value: amount}("");
        require(success, "Withdrawal failed");
        emit Withdrawn(owner, amount);
    }

    /// @dev A function to accept Ether transfers (payable)
    receive() external payable {}
}